<!DOCTYPE html>
<html lang="en">

<!-- Document head -->
<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <link rel="shortcut icon" href="img/site-favicon-ipsl.png" type="image/x-icon" />
    <title>IPSL - Prodiguer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS -->
    <link href="css/app.css" rel="stylesheet" media="screen">
    <link href="css/simulation.messages.css" rel="stylesheet" media="screen">
    <link href="ext/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" media="screen">
</head>

<!-- Document body -->
<body>

<!-- Template: module header -->
<script type="underscore/template" id="template-messages-header">
<header class="module-header bg-primary">
    <h2><%- simulation.activity.toUpperCase() %> ->
        <%- simulation.space.toUpperCase() %> ->
        <%- simulation.name %> [<%- simulation.tryID %>]
        <span class='pull-right'>
            <span class='simulation-details glyphicon glyphicon-list' title='View Simulation Details'></span>
        </span>
    </h2>
</header>
</script>

<script type="underscore/template" id="template-tabs">
<ul class="nav nav-pills " role="tablist">
    <% // TAB NAV: compute job messages %>
    <li role="presentation" class="active">
        <a  href="#tab-jobs-compute"
            aria-controls="profile"
            role="tab"
            title="Overview"
            data-toggle="tab">
            <strong class="text-uppercase">
                Compute Job Messages (<%= messageHistory.compute.length %>)
            </strong>
        </a>
    </li>
    <% // TAB NAV: post-processing jobs %>
    <% if (messageHistory.postProcessing.length) { %>
    <li role="presentation">
        <a  href="#tab-jobs-post-processing"
            aria-controls="profile"
            role="tab"
            title="Overview"
            data-toggle="tab">
            <strong class="text-uppercase">
                Post Processing Job Messages (<%= messageHistory.postProcessing.length %>)
            </strong>
        </a>
    </li>
    <% } %>
</ul>
<div class="tab-content">
    <% // TAB CONTENT: compute job messages %>
    <div role="tabpanel" class="tab-pane active" id="tab-jobs-compute">
        <%= APP.utils.renderTemplate("template-messages-collection", {
            MOD: MOD,
            messages: messageHistory.compute,
            jobTypeDescription:'Compute',
            displayJobInfo: false
        }) %>
    </div>
    <% // TAB CONTENT: post-processing jobs %>
    <% if (messageHistory.postProcessing.length) { %>
    <div role="tabpanel" class="tab-pane" id="tab-jobs-post-processing">
        <%= APP.utils.renderTemplate("template-messages-collection", {
            MOD: MOD,
            messages: messageHistory.postProcessing,
            jobTypeDescription:'Post-Processing',
            displayJobInfo: true
        }) %>
    </div>
    <% } %>
</div>
</script>

<!-- Template: messages collection -->
<script type="underscore/template" id="template-messages-collection">
    <table class="table table-hover table-bordered table-striped table-condensed message-history-table">
        <thead>
            <tr>
                <th title='ID' class='text-center'>
                    <small>#</small>
                </th>
                <th title='Type' class='text-center'>
                    <small>Type</small>
                </th>
                <% if (displayJobInfo) { %>
                    <th title='Job Info.'>
                        <small>Job Info.</small>
                    </th>
                <% } %>
                <th title='Job UID' class='text-center'>
                    <small>Job UID</small>
                </th>
                <th title='Timestamp' class='text-center'>
                    <small>Timestamp</small>
                </th>
                <th title='Processed' class='text-center'>
                    <small>Processed</small>
                </th>
                <th title='Latency' class='text-center'>
                    <small>Latency</small>
                </th>
                <th title='Email ID' class='text-center'>
                    <small>Email ID</small>
                </th>
                <th title='liblGCM version' class='text-center'>
                    <small>liblGCM</small>
                </th>
                <th title='View message content' class='text-center'></th>
            </tr>
        </thead>
        <tbody>
            <% _.each(messages, function(message, messageIndex) { %>
                <% if (_.indexOf(['1999', '2999', '3999'], message.typeID) != -1) { %>
                <tr id="<%= message.uid %>" class="bg-danger" style="font-weight: bold;">
                <% } else if (_.indexOf(['1900', '2900', '3900'], message.typeID) != -1) {%>
                <tr id="<%= message.uid %>" class="bg-danger">
                <% } else {%>
                <tr id="<%= message.uid %>">
                <% } %>
                    <td style='width: 40px;' class='text-center'>
                        <small><%= messageIndex + 1 %></small>
                    </td>
                    <td title='Message type' class='text-center'>
                        <small><%= message.typeID %></small>
                    </td>
                    <% if (displayJobInfo) { %>
                        <td title='Job information'>
                            <small><%= message.jobInfo %></small>
                        </td>
                    <% } %>
                    <td title='Job identifier' class='text-center'>
                        <small><%= message.jobUID %></small>
                    </td>
                    <td title='Message timestamp' class='text-center'>
                        <small><%= message.timestamp %></small>
                    </td>
                    <td title='Message processing date' class='text-center'>
                        <small><%= message.processed %></small>
                    </td>
                    <td title='Message processing latency' class='text-center'>
                        <small><%= message.latency %></small>
                    </td>
                    <td title='Email identifier' class='text-center'>
                        <small><%= message.emailID || '--' %></small>
                    </td>
                    <td title='liblGCM version' class='text-center'>
                        <small>v<%= message.producerVersion %></small>
                    </td>
                    <td title='View message content' class='message-content text-center' >
                        <small><span class='glyphicon glyphicon-envelope'></span></small>
                    </td>
                </tr>
            <% }); %>
        </tbody>
        <tfoot>
            <tr  style="border: 0px;">
                <td style="" colspan="10">
                    <span>
                        <strong><%= jobTypeDescription %> Job Messages</strong>
                    </span>
                    <span class="pull-right">
                    </span>
                </td>
            </tr>
        </tfoot>
    </table>
</script>

<!-- Template: message content dialog -->
<script type="underscore/template" id="template-message-content">
<div id='message-content-modal' class="modal fade" role="dialog" aria-labelledby="gridSystemModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel"><strong>Prodiguer Message Content</strong></h4>
            </div>
            <div class="modal-body">
                <table class="table table-hover table-bordered table-condensed table-striped message-history-table">
                    <thead>
                        <tr>
                            <th title='Field'>Field</th>
                            <th title='Value'>Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% _.each(fields, function(field) { %>
                        <tr>
                            <td title='Field Name' title='<%= field[0] %>'><strong><%= field[0] %></strong></td>
                            <td title='Field Value' title='<%= field[1] %>'><%= field[1] %></td>
                        </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
</script>


<!-- JS: 3rd party libraries -->
<script src="ext/jquery-2.1.4.min.js"></script>
<script src="ext/underscore.1.8.3.min.js"></script>
<script src="ext/backbone.1.2.3.min.js"></script>
<script src="ext/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="ext/moment-2.10.6.min.js"></script>
<script src="ext/numeral-1.5.3.js"></script>

<!-- JS: 3rd party libraries (extensions) -->
<script src="ext/backbone.1.2.3-options-patch.js"></script>
<script src="ext/bootstrap-contextmenu/bootstrap-contextmenu.js"></script>

<!-- JS: Application shell -->
<script src="js/app/main.js"></script>
<script src="js/app/constants.js"></script>
<script src="js/app/init.js"></script>
<script src="js/app/options.js"></script>
<script src="js/app/state.js"></script>
<script src="js/app/templates.js"></script>
<script src="js/app/utils.js"></script>
<script src="js/app/view.content.js"></script>
<script src="js/app/view.header.js"></script>
<script src="js/app/view.footer.js"></script>
<script src="js/app/view.progress.js"></script>
<script src="js/app/view.js"></script>

<!-- JS - Module = monitoring (all) -->
<script src="js/simulation/messages/main.js"></script>
<script src="js/simulation/messages/view.js"></script>

</body>
</html>
