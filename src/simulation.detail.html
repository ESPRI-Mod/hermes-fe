<!DOCTYPE html>
<html lang="en">

<!-- Document head -->
<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <link rel="shortcut icon" href="img/site-favicon-ipsl.png" type="image/x-icon" />
    <title>IPSL - Prodiguer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS -->
    <link href="css/app.css" rel="stylesheet" media="screen">
    <link href="css/simulation.detail.css" rel="stylesheet" media="screen">
    <link href="css/simulation.shared.css" rel="stylesheet" media="screen">
    <link href="ext/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" media="screen">
</head>

<!-- Document body -->
<body>

<!-- Template: header -->
<script type="underscore/template" id="template-caption">
<header id="caption" class="module-header bg-primary">
    <h2>Simulation: <%- simulation.activity.toUpperCase() %> -> <%- simulation.space.toUpperCase() %> -> <%- simulation.name %> [<%- simulation.tryID %>]
        <span class='pull-right'>
            <span class="simulation-messages glyphicon glyphicon-envelope <%= messageCount ? '' : 'hidden' %>"
                  title="View Simulation Messages"></span>
            <span class="inter-monitoring glyphicon glyphicon-random"
                  title="Open Monitoring"></span>
        </span>
    </h2>
</header>
</script>

<!-- Template: notification info -->
<script type="underscore/template" id="template-notifications">
<div id="notification"
     class="alert monitoring-state-<%= eventTypeDescription ? simulation.executionState : 'running' %>"
     style="margin-bottom: 5px;">
    <strong>
    <% if (eventTypeDescription) { %>
        <%= eventTimestamp.slice(0, 19) %>&nbsp;::
        <%= eventTypeDescription %>&nbsp;::
        <%= simulation.name %>&nbsp;is
        <%= simulation.ext.executionState %>
    <% } else { %>
        Awaiting simulation events ...
    <% } %>
    </strong>
</div>
</script>

<!-- Template: tabs -->
<script type="underscore/template" id="template-tabs">
<ul class="nav nav-pills nav-justified" role="tablist">
    <% // TAB NAV: overview %>
    <li role="presentation" class="active">
        <a href="#tab-overview" aria-controls="profile" role="tab" data-toggle="tab">
            <strong class="text-uppercase">
                Overview
            </strong>
        </a>
    </li>
    <% // TAB NAV: config-card %>
    <% if (MOD.state.configCard) { %>
        <li role="presentation" style="border-left: 1px solid lightgrey;">
            <a href="#tab-config-card" aria-controls="profile" role="tab" data-toggle="tab">
                <strong class="text-uppercase">
                    Config Card
                </strong>
            </a>
        </li>
    <% } %>
    <% // TAB NAV: compute jobs %>
    <% // TAB NAV: post-processing jobs %>
    <% // TAB NAV: post-processing (from checker) jobs %>
    <%  _.each(MOD.jobTypes, function (jobType, jobTypeIndex) {  %>
    <%      var jobList = MOD.state.getJobs(jobType); %>
    <%      if (jobList.all.length) { %>
            <li role="presentation" style="border-left: 1px solid lightgrey;">
                <a href="#tab-jobs-<%= jobType %>" aria-controls="profile" role="tab" data-toggle="tab">
                    <strong class="text-uppercase">
                        <%= MOD.jobTypeCaptions[jobType] %> Jobs
                    </strong>
                    <span class="monitoring-state-running badge"
                          style="background-color: #D9EDF7; color: #333;">
                        <%- jobList.running.length %>
                    </span>
                    <span class="monitoring-state-running badge"
                          style="background-color: #DFF0D8; color: #333;">
                        <%- jobList.complete.length %>
                    </span>
                    <span class="monitoring-state-running badge"
                          style="background-color: #F2DEDE; color: #333;">
                        <%- jobList.error.length %>
                    </span>
                </a>
            </li>
    <%      } %>
    <%  });  %>
</ul>
<div class="tab-content">
    <% // TAB CONTENT: overview %>
    <div role="tabpanel" class="tab-pane active" id="tab-overview">
        <%= APP.utils.renderTemplate("template-tab-overview", MOD.state) %>
    </div>
    <% // TAB CONTENT: config-card %>
    <% if (MOD.state.configCard) { %>
        <div role="tabpanel" class="tab-pane" id="tab-config-card">
            <%= APP.utils.renderTemplate("template-tab-config-card", MOD.state) %>
        </div>
    <% } %>
    <% // TAB CONTENT: compute jobs %>
    <% // TAB CONTENT: post-processing jobs %>
    <% // TAB CONTENT: post-processing (from checker) jobs %>
    <%  _.each(MOD.jobTypes, function (jobType) {  %>
    <%      var jobList, jobTypeCaption; %>
    <%      jobList = MOD.state.getJobs(jobType); %>
    <%      if (jobList.all.length) { %>
                <div role="tabpanel" class="tab-pane" id="tab-jobs-<%= jobType %>">
                    <%= APP.utils.renderTemplate("template-job-list", {
                        APP: APP,
                        hidePPInfo: jobType === 'computing' || !jobList.hasInfo,
                        jobList: jobList,
                        jobType: jobType,
                        jobTypeCaption: MOD.jobTypeCaptions[jobType],
                        MOD: MOD
                    }) %>
                </div>
    <%      } %>
    <%  });  %>
</script>

<!-- Template: overview -->
<script type="underscore/template" id="template-tab-overview">
<section id="simulation-overview">

<table class="table table-striped table-hover">
    <tbody>
        <tr>
            <td class="text-right">
                <strong>Activity</strong>
            </td>
            <td>
                <%- simulation.ext.activity %>
            </td>
        </tr>
        <tr>
            <td class="text-right">
                <strong>Machine</strong>
            </td>
            <td>
                <%- simulation.ext.computeNodeMachine %>
            </td>
        </tr>
        <tr>
            <td class="text-right">
                <strong>Space</strong>
            </td>
            <td>
                <%- simulation.ext.space %>
            </td>
        </tr>
        <tr>
            <td class="text-right">
                <strong>Login</strong>
            </td>
            <td>
                <%- simulation.ext.computeNodeLogin %>
            </td>
        </tr>
        <tr>
            <td class="text-right">
                <strong>Acc. Project</strong>
            </td>
            <td>
                <%- simulation.ext.accountingProject %>
            </td>
        </tr>
        <tr>
            <td class="text-right">
                <strong>Model</strong>
            </td>
            <td>
                <%- simulation.ext.model %>
            </td>
        </tr>
        <tr>
            <td class="text-right">
                <strong>Experiment</strong>
            </td>
            <td>
                <%- simulation.ext.experiment %>
            </td>
        </tr>
        <tr>
            <td class="text-right">
                <strong>Compute start date</strong>
            </td>
            <td>
                <%- simulation.ext.executionStartDate %>
            </td>
        </tr>
        <tr>
            <td class="text-right">
                <strong>Compute end date</strong>
            </td>
            <td>
                <%- simulation.ext.executionEndDate %>
            </td>
        </tr>
        <tr>
            <td class="text-right">
                <strong>Compute Status</strong>
            </td>
            <td>
                <%- simulation.ext.executionState %>
            </td>
        </tr>
        <tr>
            <td class="text-right">
                <strong>Try</strong>
            </td>
            <td>
                <%- simulation.tryID %>
            </td>
        </tr>
        <tr>
            <td class="text-right">
                <strong>Previous Tries</strong>
            </td>
            <td>
                <% if (simulation.tryID === 1) { %>
                    --
                <% } else { %>
                <select id='previous-try-select'>
                    <option value="0"></option>
                    <% _.each(_.range(simulation.tryID - 1), function(tryID) { %>
                    <option value="<%- tryID + 1 %>"><%- tryID + 1 %></option>
                    <% }); %>
                </select>
                <% } %>
            </td>
        </tr>
        <tr>
            <td class="text-right">
                <strong>Output start date</strong>
            </td>
            <td>
                <%- simulation.ext.outputStartDate %>
            </td>
        </tr>
        <tr>
            <td class="text-right">
                <strong>Output end date</strong>
            </td>
            <td>
                <%- simulation.ext.outputEndDate %>
            </td>
        </tr>
    </tbody>
</table>
</section>
</script>

<!-- Template: config card -->
<script type="underscore/template" id="template-tab-config-card">
<section id="simulation-config-card">
    <textarea class='form-control' rows='45' cols='40'><%- configCard %></textarea>
</section>
</script>

<!-- Template: job list -->
<script type="underscore/template" id="template-job-list">
<section id="job-list-<%= jobType %>">
    <table class='table table-hover table-bordered table-condensed job-history-table'>
        <thead>
            <tr>
                <th title='ID' class='text-center'>#</th>
                <th title='Post Processing Information' class='<%= hidePPInfo ? 'hidden' : '' %>'>Info.</th>
                <th title='Start Date' class='text-center'>Start Date</th>
                <th title='End Date' class='text-center'>End Date</th>
                <th title='Duration' class='text-center'>Duration</th>
                <th title='Delay' class='text-center'>Lateness</th>
            </tr>
        </thead>
        <tbody>
            <% _.each(jobList.all.reverse(), function(job, jobIndex) { %>
            <%= APP.utils.renderTemplate("template-job-detail", {
                    APP: APP,
                    MOD: MOD,
                    job: job,
                    jobIndex: jobList.all.length - jobIndex,
                    jobList,
                    jobType: jobType,
                    hidePPInfo: hidePPInfo
                }) %>
            <% }); %>
        </tbody>
        <tfoot>
            <tr  style="border: 0px;">
                <td style="text-align: right; border: 0px;" colspan="6">
                    <span class="monitoring-state-running badge"
                          style="background-color: #D9EDF7; color: #333;">
                        <%- jobList.running.length %> RUNNING
                    </span>
                    <span class="monitoring-state-running badge"
                          style="background-color: #DFF0D8; color: #333;">
                        <%- jobList.complete.length %> COMPLETE
                    </span>
                    <span class="monitoring-state-running badge"
                          style="background-color: #F2DEDE; color: #333;">
                        <%- jobList.error.length %> ERROR
                    </span>
                </td>
            </tr>
        </tfoot>
    </table>
</section>
</script>

<!-- Template: job detail -->
<script type="underscore/template" id="template-job-detail">
<tr id="<%= job.jobUID %>" class="<%= MOD.getStateCSS(job.executionState) %>">
    <td style='width: 40px;' class='id text-center' title='<%= jobIndex %>'><%= jobIndex %></td>
    <td class='postProcessingInfo <%= hidePPInfo ? 'hidden' : '' %>' title='<%= job.ext.postProcessingInfo %>'><%= job.ext.postProcessingInfo %></td>
    <td style='width: <%= hidePPInfo  ? '24%' : '15%' %>;' class='executionStartDate text-center' title='<%= job.ext.executionStartDate %>'><%= job.ext.executionStartDate %></td>
    <td style='width: <%= hidePPInfo  ? '24%' : '15%' %>;' class='executionEndDate text-center' title='<%= job.ext.executionEndDate %>'><%= job.ext.executionEndDate %></td>
    <td style='width: <%= hidePPInfo  ? '24%' : '15%' %>;' class='duration text-center' title='<%= job.ext.duration %>'><%= job.ext.duration %></td>
    <td style='width: <%= hidePPInfo  ? '24%' : '15%' %>;' class='lateness text-center' title='<%= job.ext.lateness %>'><%= job.ext.lateness %></td>
</tr>
</script>

<!-- Template: web-socket close dialog -->
<script type="underscore/template" id="ws-close-dialog-template">
<div id="ws-close-dialog" class="modal fade" role="dialog" aria-labelledby="ws-close-dialog-label" aria-hidden="true" tabindex=-1>
    <div class='modal-dialog'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h4 class='modal-title' id='ws-close-dialog-label'><%= APP.title %> <%= MOD.title %> v<%= APP.version %></h4>
            </div>
            <div class='modal-body'>
                The Prodiguer web socket server connection has been interrupted.
            </div>
            <div class='modal-footer'>
                <button type='button' class='btn btn-primary' id='ws-close-dialog-refresh-page-button'>Refresh page</button>
            </div>
        </div>
    </div>
</div>
</script>

<!-- JS: 3rd party libraries -->
<script src="ext/jquery-2.1.4.min.js"></script>
<script src="ext/underscore.1.8.3.min.js"></script>
<script src="ext/backbone.1.2.3.min.js"></script>
<script src="ext/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="ext/moment-2.10.6.min.js"></script>
<script src="ext/numeral-1.5.3.js"></script>

<!-- JS: 3rd party libraries (extensions) -->
<script src="ext/backbone.1.2.3-options-patch.js"></script>
<script src="ext/bootstrap-contextmenu/bootstrap-contextmenu.js"></script>

<!-- JS: Application shell -->
<script src="js/app/main.js"></script>
<script src="js/app/constants.js"></script>
<script src="js/app/init.js"></script>
<script src="js/app/options.js"></script>
<script src="js/app/state.js"></script>
<script src="js/app/templates.js"></script>
<script src="js/app/utils.js"></script>
<script src="js/app/view.content.js"></script>
<script src="js/app/view.header.js"></script>
<script src="js/app/view.footer.js"></script>
<script src="js/app/view.progress.js"></script>
<script src="js/app/view.js"></script>

<!-- JS: Module = monitoring (one) -->
<script src="js/simulation/monitoring/shared/main.js"></script>
<script src="js/simulation/monitoring/shared/events.js"></script>
<script src="js/simulation/monitoring/shared/utils.cv.js"></script>
<script src="js/simulation/monitoring/shared/utils.im.js"></script>
<script src="js/simulation/monitoring/shared/utils.ws.js"></script>
<script src="js/simulation/monitoring/detail/init.js"></script>
<script src="js/simulation/monitoring/detail/state.js"></script>
<script src="js/simulation/monitoring/detail/data.extender.job.js"></script>
<script src="js/simulation/monitoring/detail/data.extender.simulation.js"></script>
<script src="js/simulation/monitoring/detail/data.parser.js"></script>
<script src="js/simulation/monitoring/detail/events.fetch.js"></script>
<script src="js/simulation/monitoring/detail/events.ws.js"></script>
<script src="js/simulation/monitoring/detail/view.js"></script>

</body>
</html>
